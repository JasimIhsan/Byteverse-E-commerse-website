<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <title><%= title %></title>
        <meta name="keywords" content="HTML5 Template" />
        <meta name="description" content="Molla - Bootstrap eCommerce Template" />
        <meta name="author" content="p-themes" />
        <!-- Favicon -->
        <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/icons/apple-touch-icon.png" />
        <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/icons/favicon-32x32.png" />
        <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/icons/favicon-16x16.png" />
        <link rel="manifest" href="/assets/images/icons/site.html" />
        <link rel="mask-icon" href="/assets/images/icons/safari-pinned-tab.svg" color="#666666" />
        <link rel="shortcut icon" href="/assets/images/icons/favicon.ico" />
        <meta name="apple-mobile-web-app-title" content="Molla" />
        <meta name="application-name" content="Molla" />
        <meta name="msapplication-TileColor" content="#cc9966" />
        <meta name="msapplication-config" content="/assets/images/icons/browserconfig.xml" />
        <meta name="theme-color" content="#ffffff" />
        <!-- Plugins CSS File -->
        <link rel="stylesheet" href="/assets/css/bootstrap.min.css" />
        <!-- Main CSS File -->
        <link rel="stylesheet" href="/assets/css/style.css" />
        <link rel="stylesheet" href="/css/user/main.css" />
        <style>
            .profile-header {
                display: flex;
                align-items: center;
                padding: 1.5rem;
                background-color: #f9f9f9;
                border-bottom: 1px solid #eaeaea;
            }
            .avatar {
                width: 80px;
                height: 80px;
                border-radius: 50%;
                margin-right: 1rem;
            }
            .profile-info h1 {
                margin: 0;
                font-size: 1.5rem;
            }
            .profile-info p {
                margin: 0.5rem 0 0;
                color: #666;
            }
            .tabs {
                display: flex;
                border-bottom: 1px solid #eaeaea;
            }
            .tab {
                flex: 1;
                text-align: center;
                padding: 1rem;
                background-color: #f9f9f9;
                cursor: pointer;
                transition: background-color 0.3s;
                font-size: 1.5rem;
                font-weight: 500;
                color: #5c59e8;
            }
            .tab.active {
                background-color: #fff;
                border-bottom: 2px solid #5c59e8;
            }
            .tab-content {
                padding: 1.5rem;
            }
            .form-group {
                margin-bottom: 1rem;
            }
            label {
                display: block;
                margin-bottom: 0.5rem;
                font-weight: bold;
                font-size: 1rem;
            }
            input[type="text"],
            input[type="email"],
            input[type="password"] {
                width: 100%;
                padding: 1rem;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 1rem;
            }
            button {
                background-color: #5c59e8;
                color: #fff;
                border: none;
                padding: 0.75rem 2rem;
                font-size: 1.5rem;
                border-radius: 4px;
                cursor: pointer;
                transition: background-color 0.3s;
                margin-top: 20px;
            }
            button:hover {
                background-color: #413fbf;
            }
            .view-mode,
            .edit-mode {
                margin-bottom: 1rem;
            }
            .edit-mode {
                display: none;
            }
            .view-mode p {
                margin: 0.5rem 0;
            }
        </style>
    </head>

    <body>
        <div class="page-wrapper">
            <header class="header">
                <div class="header-middle sticky-header">
                    <div class="container">
                        <div class="header-left">
                            <button class="mobile-menu-toggler">
                                <span class="sr-only">Toggle mobile menu</span>
                                <i class="icon-bars"></i>
                            </button>

                            <a href="#" class="logo">
                                <span style="font-size: 2.5rem; font-weight: 600; color: black">Byteverse</span>
                            </a>

                            <nav class="main-nav">
                                <ul class="menu sf-arrows">
                                    <li>
                                        <a href="/">Home</a>
                                    </li>
                                    <li>
                                        <a href="/shop">Shop</a>
                                    </li>
                                    <li>
                                        <a href="#">About</a>
                                    </li>
                                    <li>
                                        <a href="#">Contact</a>
                                    </li>
                                    <li>
                                        <a href="#">Help</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>

                        <div class="header-right">
                            <div class="dropdown cart-dropdown">
                                <% if (userLoggedIn) { %>
                                <a href="/profile/wishlist" class="dis-block icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11">
                                    <img style="width: 30px" src="/images/icons/wishlist.png" alt="wishlist" />
                                </a>
                                <% } else { %>
                                <a href="/login" class="dis-block icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11">
                                    <img style="width: 30px" src="/images/icons/wishlist.png" alt="wishlist" />
                                </a>
                                <% } %>
                            </div>
                            <div class="dropdown cart-dropdown">
                                <% if (userLoggedIn) { %>
                                <a href="/cart">
                                    <img style="width: 30px" src="/images/icons/cart.png" alt="Account" />
                                </a>
                                <% } else { %>
                                <a href="/login">
                                    <img style="width: 30px" src="/images/icons/cart.png" alt="Account" />
                                </a>
                                <% } %>
                            </div>
                            <div class="dropdown cart-dropdown">
                                <% if (userLoggedIn) { %>
                                <a href="/<%= user._id %>/profile">
                                    <img style="width: 30px" src="/images/icons/user.png" alt="Account" />
                                </a>
                                <% } else { %>
                                <a href="/login">
                                    <img style="width: 30px" src="/images/icons/user.png" alt="Account" />
                                </a>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <main class="main">
                <div class="page-header text-center" style="background-image: url('/assets/images/page-header-bg.jpg')">
                    <div class="container">
                        <h1 class="page-title">My Account</h1>
                    </div>
                </div>
                <nav aria-label="breadcrumb" class="breadcrumb-nav mb-3">
                    <div class="container">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/">Home</a></li>
                            <li class="breadcrumb-item"><a href="#">Shop</a></li>
                            <li class="breadcrumb-item active" aria-current="page">My Account</li>
                        </ol>
                    </div>
                </nav>

                <div class="page-content">
                    <div class="dashboard">
                        <div class="container">
                            <div class="row">
                                <aside class="col-md-4 col-lg-3">
                                    <ul class="nav nav-dashboard flex-column mb-3 mb-md-0">
                                        <li class="nav-item">
                                            <a class="nav-link active" href="/<%= user._id %>/profile">Dashboard</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" href="/<%= user._id %>/profile/orders">Orders</a>
                                        </li>

                                        <li class="nav-item">
                                            <a class="nav-link" href="/<%= user._id %>/profile/address">Addresses</a>
                                        </li>
                                        <li class="nav-item">
                                            <form action="/logout" method="POST" style="display: inline">
                                                <button type="submit" class="nav-link" style="border: none; background: none; padding: 0">Sign Out</button>
                                            </form>
                                        </li>
                                    </ul>
                                </aside>

                                <div class="col-md-8 col-lg-9">
                                    <div class="tab-content">
                                        <div>
                                            <h4 class="card-title mb-2" style="font-size: 2.5rem">Dashboard</h4>

                                            <div class="card card-dashboard mb-3">
                                                <div class="grid" style="display: flex; flex-direction: column">
                                                    <header class="profile-header p-5">
                                                        <div class="profile-info">
                                                            <h1 style="font-size: 2rem"><%= user.username %></h1>
                                                            <p style="font-size: 1.5rem"><%= user.email %></p>
                                                        </div>
                                                    </header>
                                                    <div class="tabs">
                                                        <div class="tab active" id="profileTab">Profile</div>
                                                        <div class="tab" id="passwordTab">Password</div>
                                                    </div>
                                                    <div class="tab-content p-5" id="profileContent">
                                                        <div class="view-mode" id="profileViewMode">
                                                            <h2 style="font-size: 20px">Profile Information</h2>
                                                            <p style="font-size: 1.5rem"><strong>Name:</strong> <span id="nameDisplay"><%= user.username %></span></p>
                                                            <p style="font-size: 1.5rem"><strong>Email:</strong> <span id="emailDisplay"><%= user.email %></span></p>
                                                            <p style="font-size: 1.5rem"><strong>Mobile Number:</strong> <span id="mobileDisplay"><%= user.mobileNumber || 'Not provided' %></span></p>
                                                            <button id="editProfileBtn">Edit Profile</button>
                                                        </div>
                                                        <div class="edit-mode" id="profileEditMode" style="display: none">
                                                            <h2 style="font-size: 20px">Edit Profile</h2>
                                                            <form id="profileForm">
                                                                <div class="form-group">
                                                                    <label style="font-size: 1.5rem" for="name">Name</label>
                                                                    <input style="font-size: 1.5rem" type="text" id="name" value="<%= user.username %>" required />
                                                                </div>
                                                                <div class="form-group">
                                                                    <label style="font-size: 1.5rem" for="email">Email <span style="font-weight: normal; color: red; font-size: 1.3rem">* email cannot be changed</span></label>
                                                                    <input style="font-size: 1.5rem" type="email" id="email" value="<%= user.email %>" required readonly disabled />
                                                                </div>
                                                                <div class="form-group">
                                                                    <label style="font-size: 1.5rem" for="mobileNumber">Mobile Number</label>
                                                                    <input style="font-size: 1.5rem" type="text" id="mobileNumber" value="<%= user.mobileNumber || '' %>" required />
                                                                </div>
                                                                <button type="submit">Update Profile</button>
                                                                <button style="margin-left: 10px" type="button" id="cancelProfileEdit">Cancel</button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                    <div class="tab-content p-5" id="passwordContent" style="display: none">
                                                        <div class="view-mode" id="passwordViewMode">
                                                            <h2 style="font-size: 20px">Password</h2>
                                                            <p>Your password is securely stored. Click the button below to change it.</p>
                                                            <button id="editPasswordBtn">Change Password</button>
                                                        </div>
                                                        <div class="edit-mode" id="passwordEditMode" style="display: none">
                                                            <h2 style="font-size: 20px">Change Password</h2>
                                                            <!-- Include Font Awesome in your HTML (head section) -->
                                                            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />

                                                            <form id="passwordForm">
                                                                <div class="form-group">
                                                                    <label style="font-size: 1.5rem" for="currentPassword">Current Password</label>
                                                                    <div style="position: relative">
                                                                        <input style="font-size: 1.5rem" type="password" id="currentPassword" required />
                                                                        <button type="button" class="toggle-password" data-target="#currentPassword" style="position: absolute; right: 3px; top: -14px; color: #000; border: none; background: none; cursor: pointer">
                                                                            <i class="fas fa-eye" id="currentPasswordToggle"></i>
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label style="font-size: 1.5rem" for="newPassword">New Password</label>
                                                                    <div style="position: relative">
                                                                        <input style="font-size: 1.5rem" type="password" id="newPassword" required />
                                                                        <button type="button" class="toggle-password" data-target="#newPassword" style="position: absolute; right: 3px; top: -14px; color: #000; border: none; background: none; cursor: pointer">
                                                                            <i class="fas fa-eye" id="newPasswordToggle"></i>
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label style="font-size: 1.5rem" for="confirmPassword">Confirm New Password</label>
                                                                    <div style="position: relative">
                                                                        <input style="font-size: 1.5rem" type="password" id="confirmPassword" required />
                                                                        <button type="button" class="toggle-password" data-target="#confirmPassword" style="position: absolute; right: 3px; top: -14px; color: #000; border: none; background: none; cursor: pointer">
                                                                            <i class="fas fa-eye" id="confirmPasswordToggle"></i>
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                                <button type="submit">Change Password</button>
                                                                <button type="button" id="cancelPasswordEdit">Cancel</button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <footer class="footer">
                <div class="footer-middle">
                    <div class="container">
                        <div class="row">
                            <div class="col-sm-6 col-lg-3">
                                <div class="widget widget-about">
                                    <!-- <img src="/assets/images/logo.png" class="footer-logo" alt="Footer Logo" width="105" height="25" /> -->
                                    <h3><strong>Byteverse</strong></h3>
                                    <p>Praesent dapibus, neque id cursus ucibus, tortor neque egestas augue, eu vulputate magna eros eu erat.</p>

                                    <div class="social-icons">
                                        <a href="#" class="social-icon" target="_blank" title="Facebook"><i class="icon-facebook-f"></i></a>
                                        <a href="#" class="social-icon" target="_blank" title="Twitter"><i class="icon-twitter"></i></a>
                                        <a href="#" class="social-icon" target="_blank" title="Instagram"><i class="icon-instagram"></i></a>
                                        <a href="#" class="social-icon" target="_blank" title="Youtube"><i class="icon-youtube"></i></a>
                                        <a href="#" class="social-icon" target="_blank" title="Pinterest"><i class="icon-pinterest"></i></a>
                                    </div>
                                    <!-- End .soial-icons -->
                                </div>
                                <!-- End .widget about-widget -->
                            </div>
                            <!-- End .col-sm-6 col-lg-3 -->

                            <div class="col-sm-6 col-lg-3">
                                <div class="widget">
                                    <h4 class="widget-title">Useful Links</h4>
                                    <!-- End .widget-title -->

                                    <ul class="widget-list">
                                        <li><a href="#">About </a></li>
                                        <li><a href="#">How to shop on </a></li>
                                        <li><a href="#">FAQ</a></li>
                                        <li><a href="#">Contact us</a></li>
                                        <li><a href="#">Log in</a></li>
                                    </ul>
                                    <!-- End .widget-list -->
                                </div>
                                <!-- End .widget -->
                            </div>
                            <!-- End .col-sm-6 col-lg-3 -->

                            <div class="col-sm-6 col-lg-3">
                                <div class="widget">
                                    <h4 class="widget-title">Customer Service</h4>
                                    <!-- End .widget-title -->

                                    <ul class="widget-list">
                                        <li><a href="#">Payment Methods</a></li>
                                        <li><a href="#">Money-back guarantee!</a></li>
                                        <li><a href="#">Returns</a></li>
                                        <li><a href="#">Shipping</a></li>
                                        <li><a href="#">Terms and conditions</a></li>
                                        <li><a href="#">Privacy Policy</a></li>
                                    </ul>
                                    <!-- End .widget-list -->
                                </div>
                                <!-- End .widget -->
                            </div>
                            <!-- End .col-sm-6 col-lg-3 -->

                            <div class="col-sm-6 col-lg-3">
                                <div class="widget">
                                    <h4 class="widget-title">My Account</h4>
                                    <!-- End .widget-title -->

                                    <ul class="widget-list">
                                        <li><a href="#">Sign In</a></li>
                                        <li><a href="#">View Cart</a></li>
                                        <li><a href="#">My Wishlist</a></li>
                                        <li><a href="#">Track My Order</a></li>
                                        <li><a href="#">Help</a></li>
                                    </ul>
                                    <!-- End .widget-list -->
                                </div>
                                <!-- End .widget -->
                            </div>
                            <!-- End .col-sm-6 col-lg-3 -->
                        </div>
                        <!-- End .row -->
                    </div>
                    <!-- End .container -->
                </div>
                <!-- End .footer-middle -->

                <div class="footer-bottom">
                    <div class="container">
                        <p class="footer-copyright">Copyright © 2019 Molla Store. All Rights Reserved.</p>
                        <!-- End .footer-copyright -->
                        <figure class="footer-payments">
                            <img src="/assets/images/payments.png" alt="Payment methods" width="272" height="20" />
                        </figure>
                        <!-- End .footer-payments -->
                    </div>
                    <!-- End .container -->
                </div>
                <!-- End .footer-bottom -->
            </footer>
        </div>
        <!-- End .page-wrapper -->

        <script src="/assets/js/jquery.min.js"></script>
        <script src="/assets/js/bootstrap.bundle.min.js"></script>
        <script src="/assets/js/jquery.hoverIntent.min.js"></script>
        <script src="/assets/js/jquery.waypoints.min.js"></script>
        <script src="/assets/js/superfish.min.js"></script>
        <script src="/assets/js/owl.carousel.min.js"></script>
        <script src="/assets/js/wNumb.js"></script>
        <script src="/assets/js/bootstrap-input-spinner.js"></script>
        <script src="/assets/js/jquery.magnific-popup.min.js"></script>
        <script src="/assets/js/nouislider.min.js"></script>
        <script src="/assets/js/main.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
            document.getElementById("profileTab").addEventListener("click", function () {
                this.classList.add("active");
                document.getElementById("passwordTab").classList.remove("active");
                document.getElementById("profileContent").style.display = "block";
                document.getElementById("passwordContent").style.display = "none";
            });

            document.getElementById("passwordTab").addEventListener("click", function () {
                this.classList.add("active");
                document.getElementById("profileTab").classList.remove("active");
                document.getElementById("passwordContent").style.display = "block";
                document.getElementById("profileContent").style.display = "none";
            });

            // Profile edit mode
            document.getElementById("editProfileBtn").addEventListener("click", function () {
                document.getElementById("profileViewMode").style.display = "none";
                document.getElementById("profileEditMode").style.display = "block";
            });

            document.getElementById("cancelProfileEdit").addEventListener("click", function () {
                document.getElementById("profileViewMode").style.display = "block";
                document.getElementById("profileEditMode").style.display = "none";
            });

            // Password edit mode
            document.getElementById("editPasswordBtn").addEventListener("click", function () {
                document.getElementById("passwordViewMode").style.display = "none";
                document.getElementById("passwordEditMode").style.display = "block";
            });

            document.getElementById("cancelPasswordEdit").addEventListener("click", function () {
                document.getElementById("passwordViewMode").style.display = "block";
                document.getElementById("passwordEditMode").style.display = "none";
            });

            //show password eye
            document.querySelectorAll(".toggle-password").forEach((button) => {
                button.addEventListener("click", function () {
                    const targetInput = document.querySelector(this.getAttribute("data-target"));
                    const icon = this.querySelector("i");

                    if (targetInput.type === "password") {
                        targetInput.type = "text";
                        icon.classList.remove("fa-eye");
                        icon.classList.add("fa-eye-slash");
                    } else {
                        targetInput.type = "password";
                        icon.classList.remove("fa-eye-slash");
                        icon.classList.add("fa-eye");
                    }
                });
            });

            //update profile
            document.getElementById("profileForm").addEventListener("submit", function (e) {
                e.preventDefault();

                const name = document.getElementById("name").value;
                const mobileNumber = document.getElementById("mobileNumber").value;

                axios
                    .post("/profile/update-profile", {
                        name,
                        mobileNumber,
                    })
                    .then((response) => {
                        // Handle success
                        if (response.data.success) {
                            document.getElementById("nameDisplay").textContent = name;
                            document.getElementById("mobileDisplay").textContent = mobileNumber;
                            document.querySelector(".profile-info h1").textContent = name;

                            Swal.fire({
                                icon: "success",
                                title: "Profile Updated",
                                text: "Your profile has been successfully updated!",
                                confirmButtonText: "OK",
                            }).then(() => {
                                document.getElementById("profileViewMode").style.display = "block";
                                document.getElementById("profileEditMode").style.display = "none";
                            });
                        } else {
                            Swal.fire({
                                icon: "error",
                                title: "Error",
                                text: "Error updating profile: " + response.data.message,
                            });
                        }
                    })
                    .catch((error) => {
                        console.error("Error:", error);
                        Swal.fire({
                            icon: "error",
                            title: "Error",
                            text: "There was an error updating your profile.",
                        });
                    });
            });

            //change password
            document.getElementById("passwordForm").addEventListener("submit", function (e) {
                e.preventDefault(); // Prevent the form's default submission

                const currentPassword = document.getElementById("currentPassword").value;
                const newPassword = document.getElementById("newPassword").value;
                const confirmPassword = document.getElementById("confirmPassword").value;

                // Basic validation: check if the new password matches confirm password
                if (newPassword !== confirmPassword) {
                    Swal.fire({
                        icon: "warning",
                        title: "Password Mismatch",
                        text: "New password and confirmation do not match!",
                    });
                    return;
                }

                // Send the data to the server using Axios
                axios
                    .post("/profile/update-password", {
                        currentPassword,
                        newPassword,
                    })
                    .then((response) => {
                        if (response.data.success) {
                            Swal.fire({
                                icon: "success",
                                title: "Password Changed",
                                text: "Your password has been successfully changed!",
                                confirmButtonText: "OK",
                            }).then(() => {
                                location.reload(); // Reload the page after the success
                                document.getElementById("passwordViewMode").style.display = "block";
                                document.getElementById("passwordEditMode").style.display = "none";
                            });
                        } else {
                            Swal.fire({
                                icon: "error",
                                title: "Error",
                                text: "Error changing password: " + response.data.message,
                            });
                        }
                    })
                    .catch((error) => {
                        console.error("There was an error:", error);
                        Swal.fire({
                            icon: "error",
                            title: "Error",
                            text: "There was an error changing your password. Please try again.",
                        });
                    });
            });
        </script>
    </body>
</html>
